<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Connection (async.Async_rpc.Rpc.Connection)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">async</a> &#x00BB; <a href="../../index.html">Async_rpc</a> &#x00BB; <a href="../index.html">Rpc</a> &#x00BB; Connection</nav><header class="odoc-preamble"><h1>Module <code><span>Rpc.Connection</span></code></h1></header><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel/Rpc/Connection/index.html">Async_rpc_kernel.Rpc.Connection</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_t" class="anchored"><a href="#val-sexp_of_t" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_t : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Heartbeat_config" class="anchored"><a href="#module-Heartbeat_config" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Heartbeat_config/index.html">Heartbeat_config</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Client_implementations" class="anchored"><a href="#module-Client_implementations" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Client_implementations/index.html">Client_implementations</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-description" class="anchored"><a href="#val-description" class="anchor"></a><code><span><span class="keyword">val</span> description : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-add_heartbeat_callback" class="anchored"><a href="#val-add_heartbeat_callback" class="anchor"></a><code><span><span class="keyword">val</span> add_heartbeat_callback : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span>unit <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>After <code>add_heartbeat_callback t f</code>, <code>f ()</code> will be called after every subsequent heartbeat received by <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-reset_heartbeat_timeout" class="anchored"><a href="#val-reset_heartbeat_timeout" class="anchor"></a><code><span><span class="keyword">val</span> reset_heartbeat_timeout : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../core/Core/Time_ns/Span/index.html#type-t">Core.Time_ns.Span.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Changes the heartbeat timeout and restarts the timer by setting <code>last_seen_alive</code> to the current time.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-last_seen_alive" class="anchored"><a href="#val-last_seen_alive" class="anchor"></a><code><span><span class="keyword">val</span> last_seen_alive : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../core/Core/Time_ns/index.html#type-t">Core.Time_ns.t</a></span></code></div><div class="spec-doc"><p>The last time either any message has been received or <code>reset_heartbeat_timeout</code> was called.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close" class="anchored"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : 
  <span>?streaming_responses_flush_timeout:<a href="../../../../core/Core/Time_ns/Span/index.html#type-t">Core.Time_ns.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?reason:<a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p><code>close</code> starts closing the connection's transport, and returns a deferred that becomes determined when its close completes. It is ok to call <code>close</code> multiple times on the same <code>t</code>; calls subsequent to the initial call will have no effect, but will return the same deferred as the original call.</p><p>Before closing the underlying transport's writer, <code>close</code> waits for all streaming reponses to be <code>Pipe.upstream_flushed</code> with a timeout of <code>streaming_responses_flush_timeout</code>.</p><p>The <code>reason</code> for closing the connection will be passed to callers of <code>close_reason</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close_finished" class="anchored"><a href="#val-close_finished" class="anchor"></a><code><span><span class="keyword">val</span> close_finished : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p><code>close_finished</code> becomes determined after the close of the connection's transport completes, i.e. the same deferred that <code>close</code> returns. <code>close_finished</code> differs from <code>close</code> in that it does not have the side effect of initiating a close.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close_reason" class="anchored"><a href="#val-close_reason" class="anchor"></a><code><span><span class="keyword">val</span> close_reason : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>on_close:<span>[ `started <span>| `finished</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p><code>close_reason ~on_close t</code> becomes determined when close starts or finishes based on <code>on_close</code>, but additionally returns the reason that the connection was closed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_closed" class="anchored"><a href="#val-is_closed" class="anchor"></a><code><span><span class="keyword">val</span> is_closed : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_closed t</code> returns <code>true</code> iff <code>close t</code> has been called. <code>close</code> may be called internally upon errors or timeouts.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bytes_to_write" class="anchored"><a href="#val-bytes_to_write" class="anchor"></a><code><span><span class="keyword">val</span> bytes_to_write : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>bytes_to_write</code> and <code>flushed</code> just call the similarly named functions on the <code>Transport.Writer.t</code> within a connection.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-flushed" class="anchored"><a href="#val-flushed" class="anchor"></a><code><span><span class="keyword">val</span> flushed : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div></div></details></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span>?implementations:<span><span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel/Rpc/Implementations/index.html#type-t">Implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>connection_state:<span>( <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'s</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?description:<a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../async_unix/Async_unix/Reader/index.html#type-t">Async_unix.Reader.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../async_unix/Async_unix/Writer/index.html#type-t">Async_unix.Writer.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <a href="#type-t">t</a>, <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> )</span> <a href="../../../../core/Core/Result/index.html#type-t">Core.Result.t</a></span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p>These functions are mostly the same as the ones with the same names in <code>Async_rpc_kernel.Rpc.Connection</code>; see <code>Connection_intf</code> in that library for documentation. The differences are that:</p><ul><li>they take an <code>Async_unix.Reader.t</code>, <code>Async_unix.Writer.t</code> and <code>max_message_size</code> instead of a <code>Transport.t</code></li><li>they use <code>Time</code> instead of <code>Time_ns</code></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-contains_magic_prefix" class="anchored"><a href="#val-contains_magic_prefix" class="anchor"></a><code><span><span class="keyword">val</span> contains_magic_prefix : <span><a href="../../../../async_unix/Async_unix/Reader/index.html#type-t">Async_unix.Reader.t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p>As of Feb 2017, the RPC protocol started to contain a magic number so that one can identify RPC communication. The bool returned by <code>contains_magic_prefix</code> says whether this magic number was observed.</p><p>This operation is a &quot;peek&quot; that does not advance any pointers associated with the reader. In particular, it makes sense to call <code>create</code> on a reader after calling this function.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_close" class="anchored"><a href="#val-with_close" class="anchor"></a><code><span><span class="keyword">val</span> with_close : 
  <span>?implementations:<span><span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel/Rpc/Implementations/index.html#type-t">Implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?description:<a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>connection_state:<span>( <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'s</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../async_unix/Async_unix/Reader/index.html#type-t">Async_unix.Reader.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../async_unix/Async_unix/Writer/index.html#type-t">Async_unix.Writer.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>dispatch_queries:<span>( <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>on_handshake_error:
    <span>[ `Raise <span><span>| `Call</span> of <span><a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-server_with_close" class="anchored"><a href="#val-server_with_close" class="anchor"></a><code><span><span class="keyword">val</span> server_with_close : 
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?description:<a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../async_unix/Async_unix/Reader/index.html#type-t">Async_unix.Reader.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../async_unix/Async_unix/Writer/index.html#type-t">Async_unix.Writer.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>implementations:<span><span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel/Rpc/Implementations/index.html#type-t">Implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>connection_state:<span>( <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'s</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>on_handshake_error:
    <span>[ `Raise <span>| `Ignore</span> <span><span>| `Call</span> of <span><a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-transport_maker" class="anchored"><a href="#type-transport_maker" class="anchor"></a><code><span><span class="keyword">type</span> transport_maker</span><span> = <span><a href="../../../../async_unix/Async_unix/Fd/index.html#type-t">Async_unix.Fd.t</a> <span class="arrow">&#45;&gt;</span></span> <span>max_message_size:int <span class="arrow">&#45;&gt;</span></span> <a href="../Transport/index.html#type-t">Transport.t</a></span></code></div><div class="spec-doc"><p>A function creating a transport from a file descriptor. It is responsible for setting the low-level parameters of the underlying transport.</p><p>For instance to set up a transport using <code>Async.{Reader,Writer}</code> and set a buffer age limit on the writer, you can pass this to the functions of this module:</p><pre><code>~make_transport:(fun fd ~max_message_size -&gt;
  Rpc.Transport.of_fd fd ~max_message_size ~buffer_age_limit:`Unlimited)</code></pre></div></div><div class="odoc-spec"><div class="spec type" id="type-on_handshake_error" class="anchored"><a href="#type-on_handshake_error" class="anchor"></a><code><span><span class="keyword">type</span> on_handshake_error</span><span> = </span><span>[ </span></code><table><tr id="type-on_handshake_error.Raise" class="anchored"><td class="def constructor"><a href="#type-on_handshake_error.Raise" class="anchor"></a><code><span>| </span></code><code><span>`Raise</span></code></td></tr><tr id="type-on_handshake_error.Ignore" class="anchored"><td class="def constructor"><a href="#type-on_handshake_error.Ignore" class="anchor"></a><code><span>| </span></code><code><span>`Ignore</span></code></td></tr><tr id="type-on_handshake_error.Call" class="anchored"><td class="def constructor"><a href="#type-on_handshake_error.Call" class="anchor"></a><code><span>| </span></code><code><span>`Call <span class="keyword">of</span> <span><a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></td></tr></table><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-serve" class="anchored"><a href="#val-serve" class="anchor"></a><code><span><span class="keyword">val</span> serve : 
  <span>implementations:<span><span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel/Rpc/Implementations/index.html#type-t">Implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>initial_connection_state:<span>( <span><span class="type-var">'address</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'s</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>where_to_listen:<span><span>( <span class="type-var">'address</span>, <span class="type-var">'listening_on</span> )</span> <a href="../../../../async_unix/Async_unix/Tcp/Where_to_listen/index.html#type-t">Async_unix.Tcp.Where_to_listen.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_connections:int <span class="arrow">&#45;&gt;</span></span>
  <span>?backlog:int <span class="arrow">&#45;&gt;</span></span>
  <span>?drop_incoming_connections:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?time_source:<span><span>[&gt; <a href="../../../../core/Core/index.html#type-read">Core.read</a> ]</span> <a href="../../../../async_kernel/Async_kernel/Time_source/T1/index.html#type-t">Async_kernel.Time_source.T1.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?make_transport:<a href="#type-transport_maker">transport_maker</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?auth:<span>( <span><span class="type-var">'address</span> <span class="arrow">&#45;&gt;</span></span> bool )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?on_handshake_error:<a href="#type-on_handshake_error">on_handshake_error</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?on_handler_error:<span>[ `Raise <span>| `Ignore</span> <span><span>| `Call</span> of <span><span class="type-var">'address</span> <span class="arrow">&#45;&gt;</span></span> <span>exn <span class="arrow">&#45;&gt;</span></span> unit</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'address</span>, <span class="type-var">'listening_on</span> )</span> <a href="../../../../async_unix/Async_unix/Tcp/Server/index.html#type-t">Async_unix.Tcp.Server.t</a></span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p><code>serve implementations ~port ?on_handshake_error ()</code> starts a server with the given implementation on <code>port</code>. The optional auth function will be called on all incoming connections with the address info of the client and will disconnect the client immediately if it returns false. This auth mechanism is generic and does nothing other than disconnect the client -- any logging or record of the reasons is the responsibility of the auth function itself.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-serve_inet" class="anchored"><a href="#val-serve_inet" class="anchor"></a><code><span><span class="keyword">val</span> serve_inet : 
  <span>implementations:<span><span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel/Rpc/Implementations/index.html#type-t">Implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>initial_connection_state:<span>( <span><a href="../../../../async_unix/Async_unix/Socket/Address/Inet/index.html#type-t">Async_unix.Socket.Address.Inet.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'s</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>where_to_listen:<a href="../../../../async_unix/Async_unix/Tcp/Where_to_listen/index.html#type-inet">Async_unix.Tcp.Where_to_listen.inet</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_connections:int <span class="arrow">&#45;&gt;</span></span>
  <span>?backlog:int <span class="arrow">&#45;&gt;</span></span>
  <span>?drop_incoming_connections:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?time_source:<span><span>[&gt; <a href="../../../../core/Core/index.html#type-read">Core.read</a> ]</span> <a href="../../../../async_kernel/Async_kernel/Time_source/T1/index.html#type-t">Async_kernel.Time_source.T1.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?make_transport:<a href="#type-transport_maker">transport_maker</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?auth:<span>( <span><a href="../../../../async_unix/Async_unix/Socket/Address/Inet/index.html#type-t">Async_unix.Socket.Address.Inet.t</a> <span class="arrow">&#45;&gt;</span></span> bool )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?on_handshake_error:<a href="#type-on_handshake_error">on_handshake_error</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?on_handler_error:
    <span>[ `Raise
    <span>| `Ignore</span>
    <span><span>| `Call</span> of <span><a href="../../../../async_unix/Async_unix/Socket/Address/Inet/index.html#type-t">Async_unix.Socket.Address.Inet.t</a> <span class="arrow">&#45;&gt;</span></span> <span>exn <span class="arrow">&#45;&gt;</span></span> unit</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <a href="../../../../async_unix/Async_unix/Socket/Address/Inet/index.html#type-t">Async_unix.Socket.Address.Inet.t</a>, int )</span> <a href="../../../../async_unix/Async_unix/Tcp/Server/index.html#type-t">Async_unix.Tcp.Server.t</a></span></span></code></div><div class="spec-doc"><p>As <code>serve</code>, but only accepts IP addresses, not Unix sockets; returns server immediately rather than asynchronously.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-client" class="anchored"><a href="#val-client" class="anchor"></a><code><span><span class="keyword">val</span> client : 
  <span>?implementations:<span><span class="type-var">_</span> <a href="Client_implementations/index.html#type-t">Client_implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?make_transport:<a href="#type-transport_maker">transport_maker</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?description:<a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="../../../../async_unix/Async_unix/Tcp/Where_to_connect/index.html#type-t">Async_unix.Tcp.Where_to_connect.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <a href="#type-t">t</a>, <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> )</span> <a href="../../../../core/Core/Result/index.html#type-t">Core.Result.t</a></span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p><code>client where_to_connect ()</code> connects to the server at <code>where_to_connect</code> and returns the connection or an Error if a connection could not be made. It is the responsibility of the caller to eventually call <code>close</code>.</p><p>In <code>client</code> and <code>with_client</code>, the <code>handshake_timeout</code> encompasses both the TCP connection timeout and the timeout for this module's own handshake.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-client'" class="anchored"><a href="#val-client'" class="anchor"></a><code><span><span class="keyword">val</span> client' : 
  <span>?implementations:<span><span class="type-var">_</span> <a href="Client_implementations/index.html#type-t">Client_implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?make_transport:<a href="#type-transport_maker">transport_maker</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?description:<a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'address</span> <a href="../../../../async_unix/Async_unix/Tcp/Where_to_connect/index.html#type-t">Async_unix.Tcp.Where_to_connect.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'address</span> * <a href="#type-t">t</a>, <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> )</span> <a href="../../../../core/Core/Result/index.html#type-t">Core.Result.t</a></span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p>Similar to <code>client</code>, but additionally expose the <code>Socket.Address.t</code> of the RPC server that we connected to.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_client" class="anchored"><a href="#val-with_client" class="anchor"></a><code><span><span class="keyword">val</span> with_client : 
  <span>?implementations:<span><span class="type-var">_</span> <a href="Client_implementations/index.html#type-t">Client_implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?make_transport:<a href="#type-transport_maker">transport_maker</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="../../../../async_unix/Async_unix/Tcp/Where_to_connect/index.html#type-t">Async_unix.Tcp.Where_to_connect.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'a</span>, <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> )</span> <a href="../../../../core/Core/Result/index.html#type-t">Core.Result.t</a></span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p><code>with_client where_to_connect f</code> connects to the server at <code>where_to_connect</code> and runs f until an exception is thrown or until the returned Deferred is fulfilled.</p><p>NOTE: As with <code>with_close</code>, you should be careful when using this with <code>Pipe_rpc</code>. See <code>with_close</code> for more information.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_client'" class="anchored"><a href="#val-with_client'" class="anchor"></a><code><span><span class="keyword">val</span> with_client' : 
  <span>?implementations:<span><span class="type-var">_</span> <a href="Client_implementations/index.html#type-t">Client_implementations.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_message_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?make_transport:<a href="#type-transport_maker">transport_maker</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?handshake_timeout:<a href="../../../../core/Core/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?heartbeat_config:<a href="Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?description:<a href="../../../../core/Core/Info/index.html#type-t">Core.Info.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'transport</span> <a href="../../../../async_unix/Async_unix/Tcp/Where_to_connect/index.html#type-t">Async_unix.Tcp.Where_to_connect.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span>remote_server:<span class="type-var">'transport</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'a</span>, <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> )</span> <a href="../../../../core/Core/Result/index.html#type-t">Core.Result.t</a></span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p>Similar to <code>with_client</code>, but additionally expose the <code>Socket.Address.t</code> of the RPC server that we connected to.</p></div></div></div></body></html>