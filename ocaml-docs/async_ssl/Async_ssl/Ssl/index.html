<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ssl (async_ssl.Async_ssl.Ssl)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">async_ssl</a> &#x00BB; <a href="../index.html">Async_ssl</a> &#x00BB; Ssl</nav><header class="odoc-preamble"><h1>Module <code><span>Async_ssl.Ssl</span></code></h1><p>An Async-pipe-based interface with OpenSSL.</p><p>This module allows you to create an SSL client and server, with encrypted communication between both.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Version" class="anchored"><a href="#module-Version" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Version/index.html">Version</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../Version/index.html">Version</a></span></code></div><div class="spec-doc"><p>The protocol and security level that libopenssl uses.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Opt" class="anchored"><a href="#module-Opt" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Opt/index.html">Opt</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../Opt/index.html">Opt</a></span></code></div><div class="spec-doc"><p>OpenSSL context options.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Verify_mode" class="anchored"><a href="#module-Verify_mode" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Verify_mode/index.html">Verify_mode</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../Verify_mode/index.html">Verify_mode</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-secure_ciphers" class="anchored"><a href="#val-secure_ciphers" class="anchor"></a><code><span><span class="keyword">val</span> secure_ciphers : <span>string list</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Certificate" class="anchored"><a href="#module-Certificate" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Certificate/index.html">Certificate</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Session" class="anchored"><a href="#module-Session" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Session/index.html">Session</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Connection" class="anchored"><a href="#module-Connection" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Connection/index.html">Connection</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><p>Creates either an SSL client or server.</p><p>NB: your achieved security will be very weak unless you check the connection parameters after the handshake. See the <code>Connection</code> module above.</p><p><code>version</code> is optional, and allows you to customize the specific version of SSL that this connection should be using. It may be downgraded - you should check the actually negotiated version post-connection.</p><p><code>name</code> allows you to name this connection, to make errors easier to track down.</p><p>If <code>ca_file</code> is not <code>None</code>, it points to a file of CA certificates in PEM format. It may have more than one certificate.</p><p>If <code>ca_path</code> is not <code>None</code>, it points to a directory containing CA certificates in PEM format. The files each contain one CA certificate. The certificates in <code>ca_path</code> are only looked up lazily, not eagarly.</p><p>If both <code>ca_file</code> and <code>ca_path</code> are specified, the certificates in <code>ca_file</code> will be searched before the certificates in <code>ca_path</code>.</p><p>Any certificate authorities loaded are automatically trusted by OpenSSL.</p><p><code>crt_file</code> and <code>key_file</code> are the on-disk locations of the server's public and private keys.</p><p>Any data written into <code>app_to_ssl</code> will be encrypted with SSL, and the encrypted data will eventually be written into <code>ssl_to_net</code>.</p><p>Similarly, any data written into <code>net_to_ssl</code> will be decrypted with SSL and written into <code>ssl_to_app</code>.</p><p>A picture is probably easier to understand:</p><pre>                          app_to_ssl           ssl_to_net
        +---------------+ ---------&gt; +-------+ ---------&gt; +-----+
        | CLIENT/SERVER |            |  SSL  |            | NET |
        +---------------+ &lt;--------- +-------+ &lt;--------- +-----+
                          ssl_to_app           net_to_ssl</pre><p>To close the connection and free associated memory, call <code>Connection.close</code>. This will close all the involved pipes.</p><p>The <code>session</code> argument enables the session resumption mechanism: when called with the same session value twice, the client will try to resume the session during the second call, resulting in a quicker handshake. It is your responsibility to keep the mapping between the destinations and the sessions to be used with them. Calling the client with the same <code>session</code> but with a differet <code>ca_file</code> or <code>ca_path</code> will result in an error. Use <code>Connection.session_reused</code> to find out if session resumption actually worked.</p><p>Both <code>client</code> and <code>server</code> become determined when the handshake has completed.</p><p>The <code>hostname</code> sets the hostname to pass to the server using the SNI extension.</p><div class="odoc-spec"><div class="spec value" id="val-client" class="anchored"><a href="#val-client" class="anchor"></a><code><span><span class="keyword">val</span> client : 
  <span>?version:<a href="Version/index.html#type-t">Version.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?options:<span><a href="Opt/index.html#type-t">Opt.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?name:string <span class="arrow">&#45;&gt;</span></span>
  <span>?hostname:string <span class="arrow">&#45;&gt;</span></span>
  <span>?allowed_ciphers:<span>[ `Secure <span>| `Openssl_default</span> <span><span>| `Only</span> of <span>string list</span></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?ca_file:string <span class="arrow">&#45;&gt;</span></span>
  <span>?ca_path:string <span class="arrow">&#45;&gt;</span></span>
  <span>?crt_file:string <span class="arrow">&#45;&gt;</span></span>
  <span>?key_file:string <span class="arrow">&#45;&gt;</span></span>
  <span>?verify_modes:<span><a href="Verify_mode/index.html#type-t">Verify_mode.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?session:<a href="Session/index.html#type-t">Session.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>app_to_ssl:<span>string <a href="../../../async_kernel/Async_kernel/Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>ssl_to_app:<span>string <a href="../../../async_kernel/Async_kernel/Pipe/Writer/index.html#type-t">Async.Pipe.Writer.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>net_to_ssl:<span>string <a href="../../../async_kernel/Async_kernel/Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>ssl_to_net:<span>string <a href="../../../async_kernel/Async_kernel/Pipe/Writer/index.html#type-t">Async.Pipe.Writer.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Connection/index.html#type-t">Connection.t</a> <a href="../../../async/Async/Deferred/Or_error/index.html#type-t">Async.Deferred.Or_error.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-server" class="anchored"><a href="#val-server" class="anchor"></a><code><span><span class="keyword">val</span> server : 
  <span>?version:<a href="Version/index.html#type-t">Version.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?options:<span><a href="Opt/index.html#type-t">Opt.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?name:string <span class="arrow">&#45;&gt;</span></span>
  <span>?allowed_ciphers:<span>[ `Secure <span>| `Openssl_default</span> <span><span>| `Only</span> of <span>string list</span></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?ca_file:string <span class="arrow">&#45;&gt;</span></span>
  <span>?ca_path:string <span class="arrow">&#45;&gt;</span></span>
  <span>crt_file:string <span class="arrow">&#45;&gt;</span></span>
  <span>key_file:string <span class="arrow">&#45;&gt;</span></span>
  <span>?verify_modes:<span><a href="Verify_mode/index.html#type-t">Verify_mode.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>app_to_ssl:<span>string <a href="../../../async_kernel/Async_kernel/Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>ssl_to_app:<span>string <a href="../../../async_kernel/Async_kernel/Pipe/Writer/index.html#type-t">Async.Pipe.Writer.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>net_to_ssl:<span>string <a href="../../../async_kernel/Async_kernel/Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>ssl_to_net:<span>string <a href="../../../async_kernel/Async_kernel/Pipe/Writer/index.html#type-t">Async.Pipe.Writer.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Connection/index.html#type-t">Connection.t</a> <a href="../../../async/Async/Deferred/Or_error/index.html#type-t">Async.Deferred.Or_error.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-For_testing" class="anchored"><a href="#module-For_testing" class="anchor"></a><code><span><span class="keyword">module</span> <a href="For_testing/index.html">For_testing</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>