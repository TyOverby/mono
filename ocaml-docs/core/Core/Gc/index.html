<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gc (core.Core.Gc)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">core</a> &#x00BB; <a href="../index.html">Core</a> &#x00BB; Gc</nav><header class="odoc-preamble"><h1>Module <code><span>Core.Gc</span></code></h1><p>This is a wrapper around INRIA's standard <code>Gc</code> module. Provides memory management control and statistics, and finalized values.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Stat" class="anchored"><a href="#module-Stat" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Stat/index.html">Stat</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-stat" class="anchored"><a href="#type-stat" class="anchor"></a><code><span><span class="keyword">type</span> stat</span><span> = <a href="Stat/index.html#type-t">Stat.t</a></span></code></div></div><p>The memory management counters are returned in a <code>stat</code> record.</p><p>The total amount of memory allocated by the program since it was started is (in words) <code>minor_words + major_words - promoted_words</code>. Multiply by the word size (4 on a 32-bit machine, 8 on a 64-bit machine) to get the number of bytes.</p><div class="odoc-spec"><div class="spec module" id="module-Control" class="anchored"><a href="#module-Control" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Control/index.html">Control</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-control" class="anchored"><a href="#type-control" class="anchor"></a><code><span><span class="keyword">type</span> control</span><span> = <a href="Control/index.html#type-t">Control.t</a></span></code></div></div><p>The GC parameters are given as a <code>control</code> record. Note that these parameters can also be initialised by setting the OCAMLRUNPARAM environment variable. See the documentation of ocamlrun.</p><div class="odoc-spec"><div class="spec value external" id="val-stat" class="anchored"><a href="#val-stat" class="anchor"></a><code><span><span class="keyword">val</span> stat : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-stat">stat</a></span></code></div><div class="spec-doc"><p>Return the current values of the memory management counters in a <code>stat</code> record. This function examines every heap block to get the statistics.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-quick_stat" class="anchored"><a href="#val-quick_stat" class="anchor"></a><code><span><span class="keyword">val</span> quick_stat : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-stat">stat</a></span></code></div><div class="spec-doc"><p>Same as <code>stat</code> except that <code>live_words</code>, <code>live_blocks</code>, <code>free_words</code>, <code>free_blocks</code>, <code>largest_free</code>, and <code>fragments</code> are set to 0. This function is much faster than <code>stat</code> because it does not need to go through the heap.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-counters" class="anchored"><a href="#val-counters" class="anchor"></a><code><span><span class="keyword">val</span> counters : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Float/index.html#type-t">Base.Float.t</a> * <a href="../../../base/Base/Float/index.html#type-t">Base.Float.t</a> * <a href="../../../base/Base/Float/index.html#type-t">Base.Float.t</a></span></code></div><div class="spec-doc"><p>Return <code>(minor_words, promoted_words, major_words)</code>. This function is as fast at <code>quick_stat</code>.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-minor_words" class="anchored"><a href="#val-minor_words" class="anchor"></a><code><span><span class="keyword">val</span> minor_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>The following functions return the same as <code>(Gc.quick_stat ()).Stat.f</code>, avoiding any allocation (of the <code>stat</code> record or a float). On 32-bit machines the <code>int</code> may overflow.</p><p>Note that <code>minor_words</code> does not allocate, but we do not annotate it as <code>noalloc</code> because we want the compiler to save the value of the allocation pointer register (%r15 on x86-64) to the global variable <code>caml_young_ptr</code> before the C stub tries to read its value.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-major_words" class="anchored"><a href="#val-major_words" class="anchor"></a><code><span><span class="keyword">val</span> major_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external" id="val-promoted_words" class="anchored"><a href="#val-promoted_words" class="anchor"></a><code><span><span class="keyword">val</span> promoted_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external" id="val-minor_collections" class="anchored"><a href="#val-minor_collections" class="anchor"></a><code><span><span class="keyword">val</span> minor_collections : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external" id="val-major_collections" class="anchored"><a href="#val-major_collections" class="anchor"></a><code><span><span class="keyword">val</span> major_collections : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external" id="val-heap_words" class="anchored"><a href="#val-heap_words" class="anchor"></a><code><span><span class="keyword">val</span> heap_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external" id="val-heap_chunks" class="anchored"><a href="#val-heap_chunks" class="anchor"></a><code><span><span class="keyword">val</span> heap_chunks : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external" id="val-compactions" class="anchored"><a href="#val-compactions" class="anchor"></a><code><span><span class="keyword">val</span> compactions : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external" id="val-top_heap_words" class="anchored"><a href="#val-top_heap_words" class="anchor"></a><code><span><span class="keyword">val</span> top_heap_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external" id="val-major_plus_minor_words" class="anchored"><a href="#val-major_plus_minor_words" class="anchor"></a><code><span><span class="keyword">val</span> major_plus_minor_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>This function returns <code>major_words () + minor_words ()</code>. It exists purely for speed (one call into C rather than two). Like <code>major_words</code> and <code>minor_words</code>, <code>major_plus_minor_words</code> avoids allocating a <code>stat</code> record or a float, and may overflow on 32-bit machines.</p><p>This function is not marked <code>[@@noalloc]</code> to ensure that the allocation pointer is up-to-date when the minor-heap measurement is made.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-allocated_words" class="anchored"><a href="#val-allocated_words" class="anchor"></a><code><span><span class="keyword">val</span> allocated_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>This function returns <code>major_words () - promoted_words () + minor_words ()</code>, as fast as possible. As <code>major_plus_minor_words</code>, we avoid allocating but cannot be marked <code>@@noalloc</code> yet. It may overflow in 32-bit mode.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-control">control</a></span></code></div><div class="spec-doc"><p>Return the current values of the GC parameters in a <code>control</code> record.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-set" class="anchored"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : <span><a href="#type-control">control</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p><code>set r</code> changes the GC parameters according to the <code>control</code> record <code>r</code>. The normal usage is: <code>Gc.set { (Gc.get()) with Gc.Control.verbose = 0x00d }</code></p></div></div><div class="odoc-spec"><div class="spec value external" id="val-minor" class="anchored"><a href="#val-minor" class="anchor"></a><code><span><span class="keyword">val</span> minor : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Trigger a minor collection.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-major_slice" class="anchored"><a href="#val-major_slice" class="anchor"></a><code><span><span class="keyword">val</span> major_slice : <span><a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>Do a minor collection and a slice of major collection. The argument is the size of the slice, 0 to use the automatically-computed slice size. In all cases, the result is the computed slice size.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-major" class="anchored"><a href="#val-major" class="anchor"></a><code><span><span class="keyword">val</span> major : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Do a minor collection and finish the current major collection cycle.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-full_major" class="anchored"><a href="#val-full_major" class="anchor"></a><code><span><span class="keyword">val</span> full_major : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Do a minor collection, finish the current major collection cycle, and perform a complete new cycle. This will collect all currently unreachable blocks.</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-compact" class="anchored"><a href="#val-compact" class="anchor"></a><code><span><span class="keyword">val</span> compact : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Perform a full major collection and compact the heap. Note that heap compaction is a lengthy operation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-print_stat" class="anchored"><a href="#val-print_stat" class="anchor"></a><code><span><span class="keyword">val</span> print_stat : <span><span class="xref-unresolved">Stdlib</span>.out_channel <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Print the current values of the memory management counters (in human-readable form) into the channel argument.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-allocated_bytes" class="anchored"><a href="#val-allocated_bytes" class="anchor"></a><code><span><span class="keyword">val</span> allocated_bytes : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Float/index.html#type-t">Base.Float.t</a></span></code></div><div class="spec-doc"><p>Return the total number of bytes allocated since the program was started. It is returned as a <code>float</code> to avoid overflow problems with <code>int</code> on 32-bit machines.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-keep_alive" class="anchored"><a href="#val-keep_alive" class="anchor"></a><code><span><span class="keyword">val</span> keep_alive : <span><span class="type-var">_</span> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p><code>keep_alive a</code> ensures that <code>a</code> is live at the point where <code>keep_alive a</code> is called. It is like <code>ignore a</code>, except that the compiler won't be able to simplify it and potentially collect <code>a</code> too soon.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Allocation_policy" class="anchored"><a href="#module-Allocation_policy" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Allocation_policy/index.html">Allocation_policy</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The policy used for allocating in the heap.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tune" class="anchored"><a href="#val-tune" class="anchor"></a><code><span><span class="keyword">val</span> tune : 
  <span>?logger:<span>( <span><a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?minor_heap_size:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?major_heap_increment:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?space_overhead:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?verbose:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?max_overhead:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?stack_limit:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?allocation_policy:<a href="Allocation_policy/index.html#type-t">Allocation_policy.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?window_size:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?custom_major_ratio:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?custom_minor_ratio:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?custom_minor_max_size:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Adjust the specified GC parameters.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-disable_compaction" class="anchored"><a href="#val-disable_compaction" class="anchor"></a><code><span><span class="keyword">val</span> disable_compaction : 
  <span>?logger:<span>( <span><a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>allocation_policy:<span>[ `Don't_change <span><span>| `Set_to</span> of <a href="Allocation_policy/index.html#type-t">Allocation_policy.t</a></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-For_testing" class="anchored"><a href="#module-For_testing" class="anchor"></a><code><span><span class="keyword">module</span> <a href="For_testing/index.html">For_testing</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Expert" class="anchored"><a href="#module-Expert" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Expert/index.html">Expert</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The <code>Expert</code> module contains functions that novice users should not use, due to their complexity.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Stable" class="anchored"><a href="#module-Stable" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Stable/index.html">Stable</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>