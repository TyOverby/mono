<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Command_test_helpers (core_unix.Command_test_helpers)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">core_unix</a> &#x00BB; Command_test_helpers</nav><header class="odoc-preamble"><h1>Module <code><span>Command_test_helpers</span></code></h1><p>Functions to help test <code>Command</code>.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value" id="val-parse_command_line" class="anchored"><a href="#val-parse_command_line" class="anchor"></a><code><span><span class="keyword">val</span> parse_command_line : 
  <span>?path:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?summary:string <span class="arrow">&#45;&gt;</span></span>
  <span>?readme:<span>( <span>unit <span class="arrow">&#45;&gt;</span></span> string )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../core/Core/Command/Param/index.html#type-t">Core.Command.Param.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span>?on_error:<span>( <span>unit <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span>
    <span>?on_success:<span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
    unit )</span>
    <a href="../../base/Base/Staged/index.html#type-t">Core.Staged.t</a></span></span></code></div><div class="spec-doc"><p><code>parse_command_line param</code> returns a function which evaluates <code>param</code> against a string list as if those were the arguments passed to <code>param</code>. No shelling out takes place. However, the <code>param</code> is evaluated, and side effects of that evaluation do occur.</p><p>See <code>validate_command_line</code> below for a less accurate but generally safer test that does not evaluate the param. (Of course if your param is side-effect free, there's no reason to shy away from this one.)</p><p>If the command-line fails to parse, an error will be printed. If the command-line parsing code exits for any reason (e.g. you passed &quot;-help&quot;), the exit code is printed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-validate_command" class="anchored"><a href="#val-validate_command" class="anchor"></a><code><span><span class="keyword">val</span> validate_command : <span><a href="../../core/Core/Command/index.html#type-t">Core.Command.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../../core/Core/Or_error/index.html#type-t">Core.Or_error.t</a></span></span></code></div><div class="spec-doc"><p><code>validate_command command</code> provides a function <code>f</code> s.t. <code>f args</code> will parse the args against <code>command</code> without executing the body of <code>command</code> if parsing succeeds.</p><p><code>f args</code> will raise if <code>args</code> goes through an <code>Exec _</code>.</p><p>This will trigger any side-effects caused by parsing the args but it does guarentee the the args provided are completely valid.</p><p><code>validate_command command</code> does not work in top-level expect tests.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-validate_command_line" class="anchored"><a href="#val-validate_command_line" class="anchor"></a><code><span><span class="keyword">val</span> validate_command_line : 
  <span><a href="../../core/Core/Command/Shape/index.html#type-t">Core.Command.Shape.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../../core/Core/Or_error/index.html#type-t">Core.Or_error.t</a></span> )</span> <a href="../../core/Core/Or_error/index.html#type-t">Core.Or_error.t</a></span></span></code></div><div class="spec-doc"><p><code>validate_command_line shape</code> provides a function <code>f</code> s.t. <code>f args</code> is best-effort check of <code>args</code> against the command described by <code>shape</code>, without actual execution of that command.</p><p><code>validate_command_line</code> raises if any subcommand of <code>shape</code> would exec another command binary. This prevents us from introducing unexpected external dependencies into tests.</p><p>What we check:</p><p>1. <code>args</code> refers to a valid subcommand of <code>shape</code>.</p><p>2. <code>args</code> passes an acceptable number of anonymous arguments.</p><p>3. <code>args</code> passes flags that exist, an acceptable number of times, and with arguments where they are expected.</p><p>What we do not check:</p><p>1. Whether argument have acceptable values. E.g., it falsely accepts floats where ints are expected.</p><p>2. Side effects during argument parsing, including aborting further parsing of the command line. E.g., it does not handle <code>-help</code> or <code>escape</code> flags correctly.</p><p>3. Aliases excluded from help. E.g., <code>--help</code>.</p><p>4. <code>full_flag_required</code>. We assume every flag can be passed by prefix.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-complete" class="anchored"><a href="#val-complete" class="anchor"></a><code><span><span class="keyword">val</span> complete : 
  <span>?which_arg:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="../../core/Core/Command/Param/index.html#type-t">Core.Command.Param.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>args:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>complete ?which_arg param ~args</code> prints the completion suggestions to stderr.</p><p>Thread safety:</p><p><code>complete</code> is not in general thread-safe. It sets and then restores the environment variable <code>COMP_CWORD</code>. However, the cooperative multi-threading semantics of <code>Async</code> mean that other async jobs will not see the altered environments.</p><p>Side effects:</p><p><code>complete</code> will not perform the side effects of the param proper (e.g., due to the <code>f</code> of a <code>Param.map ~f</code>).</p><p><code>complete</code> will perform side effects of completion (e.g., due to the <code>complete</code> of <code>Arg_type.create ~complete</code>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-complete_command" class="anchored"><a href="#val-complete_command" class="anchor"></a><code><span><span class="keyword">val</span> complete_command : 
  <span>?complete_subcommands:
    <span>( <span>path:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
      <span>part:string <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>string list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
      <span><span>string list</span> option</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?which_arg:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../core/Core/Command/index.html#type-t">Core.Command.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>args:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>As <code>complete</code> but applies to an intact <code>Command</code>.</p></div></div></div></body></html>