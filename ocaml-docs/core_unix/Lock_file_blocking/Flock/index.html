<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Flock (core_unix.Lock_file_blocking.Flock)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">core_unix</a> &#x00BB; <a href="../index.html">Lock_file_blocking</a> &#x00BB; Flock</nav><header class="odoc-preamble"><h1>Module <code><span>Lock_file_blocking.Flock</span></code></h1><p>This just uses <code>flock</code>. The main reason this module exists is that <code>create</code> won't let you release locks, so we need a new interface.</p><p>Another difference is that implementation is simpler because it omits some of the features, such as</p><p>1. Unlinking on exit. That seems unsafe. Consider the following scenario:</p><ul><li>both a and b create and open the file</li><li>a locks, unlinks and unlocks it</li><li>b locks and stays in critical section</li><li>c finds that there is no file, creates a new one, locks it and enters critical section You end up with b and c in the critical section together!</li></ul><p>2. Writing pid or message in the file. The file is shared between multiple processes so this feature seems hard to think about, and it already lead to weird code. Let's just remove it. You can still find who holds the file open by inspecting output of <code>lsof</code>.</p><p>3. <code>close_on_exec = false</code> There is no objective reason to omit that, but I can't think of a reason to support it either.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-lock_exn" class="anchored"><a href="#val-lock_exn" class="anchor"></a><code><span><span class="keyword">val</span> lock_exn : 
  <span>?lock_owner_uid:int <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span>lock_path:string <span class="arrow">&#45;&gt;</span></span>
  <span>[ <span>`We_took_it of <a href="#type-t">t</a></span> <span>| `Somebody_else_took_it</span> ]</span></span></code></div><div class="spec-doc"><p>Raises an exception if taking the lock fails for any reason other than somebody else holding the lock. Optionally sets the lock owner to <code>lock_owner_uid</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-unlock_exn" class="anchored"><a href="#val-unlock_exn" class="anchor"></a><code><span><span class="keyword">val</span> unlock_exn : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Raises an exception if this lock was already unlocked earlier.</p></div></div></div></body></html>