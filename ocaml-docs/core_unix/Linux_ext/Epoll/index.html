<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Epoll (core_unix.Linux_ext.Epoll)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">core_unix</a> &#x00BB; <a href="../index.html">Linux_ext</a> &#x00BB; Epoll</nav><header class="odoc-preamble"><h1>Module <code><span>Linux_ext.Epoll</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Flags" class="anchored"><a href="#module-Flags" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Flags/index.html">Flags</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>An <code>Epoll.t</code> maintains a map from <code>File_descr.t</code> to <code>Flags.t</code>, where the domain is the set of file descriptors that one is interested in, and the flags associated with each file descriptor specify the types of events one is interested in being notified about for that file descriptor. Our implementation maintains a user-level table equivalent to the kernel epoll set, so that <code>sexp_of_t</code> produces useful human-readable information, and so that we can present our standard table interface.</p><p>The implementation assumes that one never closes a file descriptor that is the domain of an <code>Epoll.t</code>, since doing so might remove the <code>fd</code> from the kernel epoll set without the implementation's knowledge.</p><p>An <code>Epoll.t</code> also has a buffer that is used to store the set of ready <code>fd</code>s returned by calling <code>wait</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_t" class="anchored"><a href="#val-sexp_of_t" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_t : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-invariant" class="anchored"><a href="#val-invariant" class="anchor"></a><code><span><span class="keyword">val</span> invariant : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span>( <span>num_file_descrs:int <span class="arrow">&#45;&gt;</span></span> <span>max_ready_events:int <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> )</span> <a href="../../../core/Core/Or_error/index.html#type-t">Core.Or_error.t</a></span></span></code></div><div class="spec-doc"><p><code>create ~num_file_descrs</code> creates a new epoll set able to watch file descriptors in [0, <code>num_file_descrs</code>). Additionally, the set allocates space for reading the &quot;ready&quot; events when <code>wait</code> returns, allowing for up to <code>max_ready_events</code> to be returned in a single call to <code>wait</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close" class="anchored"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><p>Map operations</p><div class="odoc-spec"><div class="spec value" id="val-find" class="anchored"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Core_unix/File_descr/index.html#type-t">Core_unix.File_descr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> option</span></span></code></div><div class="spec-doc"><p><code>find</code> raises in the case that <code>t</code> is closed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_exn" class="anchored"><a href="#val-find_exn" class="anchor"></a><code><span><span class="keyword">val</span> find_exn : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Core_unix/File_descr/index.html#type-t">Core_unix.File_descr.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Flags/index.html#type-t">Flags.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-set" class="anchored"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Core_unix/File_descr/index.html#type-t">Core_unix.File_descr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-remove" class="anchored"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Core_unix/File_descr/index.html#type-t">Core_unix.File_descr.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-iter" class="anchored"><a href="#val-iter" class="anchor"></a><code><span><span class="keyword">val</span> iter : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>f:<span>( <span><a href="../../Core_unix/File_descr/index.html#type-t">Core_unix.File_descr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fold" class="anchored"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>init:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span>f:<span>( <span><a href="../../Core_unix/File_descr/index.html#type-t">Core_unix.File_descr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-wait" class="anchored"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>timeout:<span>[ `Never <span>| `Immediately</span> <span><span>| `After</span> of <a href="../../../core/Core/Time_ns/Span/index.html#type-t">Core.Time_ns.Span.t</a></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>[ `Ok <span>| `Timeout</span> ]</span></span></code></div><div class="spec-doc"><p><code>wait t ~timeout</code> blocks until at least one file descriptor in <code>t</code> is ready for one of the events it is being watched for, or <code>timeout</code> passes. <code>wait</code> side effects <code>t</code> by storing the ready set in it. One can subsequently access the ready set by calling <code>iter_ready</code> or <code>fold_ready</code>.</p><p>With <code>wait ~timeout:(`After span)</code>, <code>span &lt;= 0</code> is treated as <code>0</code>. If <code>span &gt; 0</code>, then <code>span</code> is rounded to the nearest millisecond, with a minimum value of one millisecond.</p><p>Note that this method should not be considered thread-safe. There is mutable state in <code>t</code> that will be changed by invocations to <code>wait</code> that cannot be prevented by mutexes around <code>wait</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-wait_timeout_after" class="anchored"><a href="#val-wait_timeout_after" class="anchor"></a><code><span><span class="keyword">val</span> wait_timeout_after : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../core/Core/Time_ns/Span/index.html#type-t">Core.Time_ns.Span.t</a> <span class="arrow">&#45;&gt;</span></span> <span>[ `Ok <span>| `Timeout</span> ]</span></span></code></div><div class="spec-doc"><p><code>wait_timeout_after t span = wait t ~timeout:(`After span)</code>. <code>wait_timeout_after</code> is a performance hack to avoid allocating <code>`After span</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-iter_ready" class="anchored"><a href="#val-iter_ready" class="anchor"></a><code><span><span class="keyword">val</span> iter_ready : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>f:<span>( <span><a href="../../Core_unix/File_descr/index.html#type-t">Core_unix.File_descr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>iter_ready</code> and <code>fold_ready</code> iterate over the ready set computed by the last call to <code>wait</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_ready" class="anchored"><a href="#val-fold_ready" class="anchor"></a><code><span><span class="keyword">val</span> fold_ready : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>init:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span>f:<span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Core_unix/File_descr/index.html#type-t">Core_unix.File_descr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Expert" class="anchored"><a href="#module-Expert" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Expert/index.html">Expert</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>