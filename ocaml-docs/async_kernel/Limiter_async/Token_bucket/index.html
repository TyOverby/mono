<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Token_bucket (async_kernel.Limiter_async.Token_bucket)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">async_kernel</a> &#x00BB; <a href="../index.html">Limiter_async</a> &#x00BB; Token_bucket</nav><header class="odoc-preamble"><h1>Module <code><span>Limiter_async.Token_bucket</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_t" class="anchored"><a href="#val-sexp_of_t" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_t : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-u" class="anchored"><a href="#type-u" class="anchor"></a><code><span><span class="keyword">type</span> <span>_ u</span></span><span> = <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-create_exn" class="anchored"><a href="#val-create_exn" class="anchor"></a><code><span><span class="keyword">val</span> create_exn : 
  <span>burst_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>sustained_rate_per_sec:float <span class="arrow">&#45;&gt;</span></span>
  <span>continue_on_error:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?in_flight_limit:int <span class="arrow">&#45;&gt;</span></span>
  <span>?initial_burst_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-enqueue_exn" class="anchored"><a href="#val-enqueue_exn" class="anchor"></a><code><span><span class="keyword">val</span> enqueue_exn : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?allow_immediate_run:bool <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>enqueue_exn t x f a</code> enqueues an immediate job consuming <code>x</code> tokens, running <code>f</code> on input <code>a</code>.</p><p>if <code>allow_immediate_run</code> is true then <code>f</code> is allowed to run within the same async job as <code>enqueue_exn</code> iff there are enough tokens available to fully run the job and there are no other previously enqueued jobs that have not run. If this is the case, it is run before <code>enqueue_exn</code> returns. Otherwise no part of <code>f</code> is run before <code>enqueue_exn</code> returns.</p><p>If there is a failure associated with this job then the exception will be raised to the monitor in scope when <code>enqueue_exn</code> is called. Note that it may fail for a number of reasons, including <code>f</code> throws an exception, the limiter is killed, or the number of tokens requested is larger than the burst size.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-enqueue'" class="anchored"><a href="#val-enqueue'" class="anchor"></a><code><span><span class="keyword">val</span> enqueue' : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="../../Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'b</span> <a href="../Outcome/index.html#type-t">Outcome.t</a></span> <a href="../../Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></span></code></div><div class="spec-doc"><p><code>enqueue' t x f a</code> enqueues a deferred job consuming <code>x</code> tokens, running <code>f</code> on input <code>a</code>. No part of f is run before <code>enqueue'</code> returns.</p></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../module-type-Common/index.html">Common</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../module-type-Common/index.html#type-t">t</a></span> := <span><span class="type-var">'a</span> <a href="#type-u">u</a></span></span></span></code></summary><div class="odoc-spec"><div class="spec value" id="val-kill" class="anchored"><a href="#val-kill" class="anchor"></a><code><span><span class="keyword">val</span> kill : <span><span><span class="type-var">_</span> <a href="#type-u">u</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>kills <code>t</code>, which aborts all enqueued jobs that haven't started and all jobs enqueued in the future. If <code>t</code> has already been killed, then calling <code>kill t</code> has no effect. Note that kill does not affect currently running jobs in any way.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_dead" class="anchored"><a href="#val-is_dead" class="anchor"></a><code><span><span class="keyword">val</span> is_dead : <span><span><span class="type-var">_</span> <a href="#type-u">u</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_dead t</code> returns <code>true</code> if <code>t</code> was killed, either by <code>kill</code> or by an unhandled exception in a job.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_limiter" class="anchored"><a href="#val-to_limiter" class="anchor"></a><code><span><span class="keyword">val</span> to_limiter : <span><span><span class="type-var">_</span> <a href="#type-u">u</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../index.html#type-limiter">limiter</a></span></code></div><div class="spec-doc"><p>Convert to a limiter</p></div></div></details></div></div></body></html>